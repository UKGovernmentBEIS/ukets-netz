<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        logicalFilePath="changelog_camunda_schema.xml"
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.11.xsd">
    <!-- see https://camunda.jfrog.io/ui/native/camunda-bpm/org/camunda/bpm/distro/camunda-sql-scripts/ for details-->
    <changeSet id="0_1_0_CAMUNDA_CREATE_SCHEMA" author="kliropog">
        <validCheckSum>1:any</validCheckSum>
        <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/create/activiti.postgres.create.engine.sql" />
        <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/create/activiti.postgres.create.history.sql" />
        <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/create/activiti.postgres.create.case.engine.sql" />
        <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/create/activiti.postgres.create.case.history.sql" />
        <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/create/activiti.postgres.create.decision.engine.sql" />
        <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/create/activiti.postgres.create.decision.history.sql" />
        <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/create/activiti.postgres.create.identity.sql" />

        <rollback>
            <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/drop/activiti.postgres.drop.identity.sql" />
            <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/drop/activiti.postgres.drop.decision.history.sql" />
            <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/drop/activiti.postgres.drop.decision.engine.sql" />
            <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/drop/activiti.postgres.drop.case.history.sql" />
            <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/drop/activiti.postgres.drop.case.engine.sql" />
            <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/drop/activiti.postgres.drop.history.sql" />
            <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/drop/activiti.postgres.drop.engine.sql" />
        </rollback>
    </changeSet>

    <changeSet id="0_1_0_CAMUNDA_engine_7.20_to_7.21_db_updates" author="p70453">
        <preConditions onFail="CONTINUE">
            <sqlCheck expectedResult="1">select case when string_to_array(replace('7.21.0', '_', '.'),'.')::int[] > string_to_array(replace((select max(version_) from act_ge_schema_log), '_', '.'),'.')::int[] then 1 else 0 end diff</sqlCheck>
        </preConditions>
        <sqlFile encoding="utf8" splitStatements="true" stripComments="true" path="org/camunda/bpm/engine/db/upgrade/postgres_engine_7.20_to_7.21.sql" />
    </changeSet>
</databaseChangeLog>